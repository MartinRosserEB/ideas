{% extends 'base.html.twig' %}

{% block body %}
<div class="top-bar sticky" data-sticky data-margin-top="0">
    <div class="top-bar-left">
        <ul class="dropdown menu" data-dropdown-menu>
            <li><a href="{{ path('collections_index') }}"><i class="fas fa-chevron-left"></i></a></li>
            <li class="menu-text">{{ collection.name }}</li>
        </ul>
    </div>
    <div class="top-bar-right">
        <ul class="dropdown menu" data-dropdown-menu>
            <li>
                <a href="#"><i class="fas fa-bars"></i></a>
                <ul class="menu vertical">
                    {% if admin %}<li><a href="{{ path('show_users', {'collection': collection.id}) }}">Administration</a></li>{% endif %}
                    <li><a href="{{ path('create_collection') }}">Neue Ideensammlung</a></li>
                </ul>
            </li>
        </ul>
    </div>
</div>
<div>
    <p>{{ collection.description|raw }}</p>
</div>
{% if not collection.adminSettings.votingActive|default(false) %}
<div>
    <p><a href="#" onclick="javascript:loadFromUrlOpenModal('{{ path('create_idea', {'collection': collection.id}) }}');"><i class="fas fa-plus"></i></a></p>
</div>
{% endif %}

{% for idea in ideas %}
<div class="ideaContainer callout secondary">
    <a href="#" onclick="javascript:loadFromUrlOpenModal('{{ path('show_idea', {'entity': idea.id}) }}');" label="anzeigen">
        <div class="idea">{{ idea.title }}</div>
    </a>
    <div class="comments" data-toggle="commentsDropdown">{{ idea.comments|length }}</div>
    <div class="votes" data-toggle="votesDropdown">{{ idea.votes|length }}
        {% if collection.adminSettings.votingActive|default(false) %}
        <a href="javascript:voteForIdea({{ idea.id }})">
            {% if idea.getVotesForUser(app.user)|length > 0 %}<i class="fas fa-toggle-off"></i>
            {% else %}<i class="fas fa-toggle-on"></i>{% endif %}
        </a>{% endif %}
    </div>
</div>
{% endfor %}
<div class="dropdown-pane" id="commentsDropdown" data-dropdown data-hover="true" data-hover-pane="true">Anzahl der Kommentare</div>
<div class="dropdown-pane" id="votesDropdown" data-dropdown data-hover="true" data-hover-pane="true">Anzahl der Stimmen{% if collection.adminSettings.votingActive|default(false) %}, abstimmen durch Klick auf das Symbol{% endif %}</div>
{% endblock %}

{% block javascripts %}
{% if collection.adminSettings.votingActive|default(false) %}
<script>
function voteForIdea(idea) {
    var url = "{{ path('vote_for_idea', {'entity': '__id__'}) }}";
    url = url.replace('__id__', idea);
    $.post(url, function( data ) {
        location.reload();
    });
}
</script>
{% endif %}
{% endblock %}
