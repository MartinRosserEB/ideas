{% extends 'base.html.twig' %}

{% block body %}
<div class="top-bar sticky" data-sticky data-margin-top="0">
    <div class="top-bar-left">
        <ul class="dropdown menu" data-dropdown-menu>
            <li><a href="{{ path('collections_index') }}"><i class="fas fa-chevron-left"></i></a></li>
            <li class="menu-text">{{ collection.name }}</li>
        </ul>
    </div>
    <div class="top-bar-right">
        <ul class="dropdown menu" data-dropdown-menu>
            <li>
                <a href="#"><i class="fas fa-bars"></i></a>
                <ul class="menu vertical">
                    {% if admin %}
                        <li><a href="{{ path('edit_admin_settings', {'collection': collection.id}) }}">Mailvorlage</a></li>
                        <li><a href="{{ path('toggle_mode', {'collection': collection.id}) }}">{% if collection.adminSettings.votingActive %}Sammelmodus{% else %}Wahlmodus{% endif %} aktivieren</a></li>
                        <li><a href="{{ path('show_users', {'collection': collection.id}) }}">Benutzer administrieren</a></li>
                    {% endif %}
                </ul>
            </li>
        </ul>
    </div>
</div>
<div>
    <p>{{ collection.description|raw }}</p>
</div>
{% if not collection.adminSettings.votingActive|default(false) %}
<div>
    <p><a href="javascript:void(0);" onclick="javascript:$('#newIdea').show();"><i class="fas fa-plus"></i></a></p>
</div>
<div id="newIdea" style="display:none;">
    {{ form(form) }}
    <hr>
</div>
{% endif %}

{% for idea in ideas %}
<div class="ideaContainer callout secondary">
    <a href="javascript:void(0);" onclick="javascript:toggleLoadFromUrl('{{ path('show_idea', {'entity': idea.id}) }}', '#ideaExpanded_{{ idea.id }}');" label="anzeigen">
        <div class="idea"><h5>{{ idea.title }}</h5></div>
    </a>
    <div class="comments" data-toggle="commentsDropdown">{{ idea.comments|length }}</div>
    <div class="votes"{% if not collection.adminSettings.votingActive|default(false) %} data-toggle="votesDropdown"{% endif %}>
        <span id="votesCountIdea_{{ idea.id }}">{{ idea.votes|length }}</span>
        {% if collection.adminSettings.votingActive|default(false) %}
        <a href="javascript:toggleVoteForIdea({{ idea.id }})">
        <i id="votesSymbolIdea_{{ idea.id }}" class="fas
            {%- if idea.getVotesForUser(app.user)|length > 0 %} fa-toggle-off
            {%- else %} fa-toggle-on
            {%- endif -%}
        "></i>
        </a>{% endif %}
    </div>
    <div id="ideaExpanded_{{ idea.id }}"></div>
</div>
{% endfor %}
<div class="dropdown-pane" id="commentsDropdown" data-dropdown data-hover="true" data-hover-pane="true">Anzahl Kommentare</div>
{% if not collection.adminSettings.votingActive|default(false) %}
<div class="dropdown-pane" id="votesDropdown" data-dropdown data-hover="true" data-hover-pane="true">Anzahl Stimmen</div>
{% endif %}
{% endblock %}

{% block javascripts %}
{% if collection.adminSettings.votingActive|default(false) %}
<script>
function toggleVoteForIdea(idea) {
    var url = "{{ path('vote_for_idea', {'entity': '__id__'}) }}";
    url = url.replace('__id__', idea);
    $.post(url, function( data ) {
        if (data.success === true) {
            $("#votesSymbolIdea_"+idea).toggleClass('fa-toggle-off fa-toggle-on');
            $("#votesCountIdea_"+idea).html(data.voteCount);
        }
    });
}
</script>
{% endif %}
{% endblock %}
